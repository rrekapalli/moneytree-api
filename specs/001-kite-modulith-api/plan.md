# Implementation Plan: Kite-based modulith trading API

**Branch**: `001-kite-modulith-api` | **Date**: [DATE] | **Spec**: `specs/001-kite-modulith-api/spec.md`  
**Input**: Feature specification from `specs/001-kite-modulith-api/spec.md`

**Note**: This plan is generated by `/speckit.plan` and will guide design and implementation for the Kite-backed, modulith Java API.

## Summary

This feature introduces a Kite-backed market data API for the MoneyTree high-frequency trading system by replacing all NSE-based stock data endpoints with equivalents that read from `kite_*` tables while preserving existing client-facing contracts where feasible. The application remains a single Java 21 modulith deployment, with a dedicated Kite market data module, clear internal boundaries, and performance targets suitable for HFT workloads, using environment-based configuration for all Kite and database credentials.

## Technical Context

<!--
  ACTION REQUIRED: Replace the content in this section with the technical details
  for the project. The structure here is presented in advisory capacity to guide
  the iteration process.
-->

**Language/Version**: Java 21 (per constitution)  
**Primary Dependencies**: Existing MoneyPlant Java backend stack (Spring-based modulith conventions), JDBC/ORM for TimescaleDB (PostgreSQL), HTTP client for Zerodha Kite connectivity  
**Storage**: TimescaleDB (PostgreSQL) at `postres.tailce422e.ts.net:5432/MoneyTree`, using `kite_*` tables for market data  
**Testing**: JUnit-based unit tests, integration/contract tests for Kite connectivity and market data endpoints, load/performance tests for hot paths  
**Target Platform**: Linux server deployment for the MoneyTree API  
**Project Type**: Single modulith backend application with internal modules (market data, connectivity, risk, etc.)  
**Performance Goals**: Sustain at least 1,000 stock data requests per second per node with p95 latency under 150ms and p99 under 300ms for Kite-backed endpoints under normal conditions  
**Constraints**: Respect Kite API rate limits, avoid blocking I/O in hot paths, keep memory footprint stable under load, and ensure changes do not degrade existing non-stock features  
**Scale/Scope**: Initial scope limited to replacing NSE stock data endpoints with Kite-backed equivalents and aligning entities/DTOs; no new order placement features in this phase

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **HFT Safety & Regulatory Compliance**: This feature is read-only market data and does not place or modify orders; nevertheless, all changes will preserve existing audit logging for data access where applicable and must not relax any risk-related mechanisms elsewhere in the modulith.
- **Deterministic Low-Latency Execution**: Performance goals and constraints above are aligned with the constitution’s requirement for defined latency SLOs; Phase 1 will define concrete load/performance tests for Kite-backed endpoints and ensure Java 21 runtime tuning is considered for the market data module.
- **Modulith Architecture & Bounded Contexts**: The plan maintains a single deployable Java modulith, adding or refining an internal Kite market data module and a dedicated Kite connectivity module rather than introducing new deployables or cross-module database access.
- **Market Connectivity & Resilience (Zerodha Kite API)**: All Kite interactions will be funneled through a dedicated connectivity module that handles authentication, rate limiting, retries, and error mapping, in line with the constitution’s Kite integration rules.
- **Time-Series Persistence & Observability (TimescaleDB)**: The plan continues to use TimescaleDB as the authoritative store for market data; any schema or indexing changes for `kite_*` tables will be managed via migrations and will include observability (metrics/logs) to correlate data access with API performance.

**Gate Result (pre-Phase 0)**: PASS — no constitution violations identified for this feature; complexity tracking remains empty unless future design choices introduce exceptions.

## Project Structure

### Documentation (this feature)

```text
specs/001-kite-modulith-api/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)
<!--
  ACTION REQUIRED: Replace the placeholder tree below with the concrete layout
  for this feature. Delete unused options and expand the chosen structure with
  real paths (e.g., apps/admin, packages/something). The delivered plan must
  not include Option labels.
-->

```text
moneytree-api/
├── backend/                      # Existing Java 21 modulith backend (from MoneyPlant)
│   ├── src/main/java/
│   │   ├── ... existing packages ...
│   │   ├── com/moneytree/marketdata/kite/        # NEW: Kite market data module (entities, services, mappers)
│   │   ├── com/moneytree/connectivity/kite/      # NEW: Kite connectivity module (auth, rate limiting, retries)
│   │   └── com/moneytree/api/                    # API layer exposing Kite-backed endpoints, and other non nse_* table CRUD end points
│   └── src/test/java/
│       ├── com/moneytree/marketdata/kite/        # Unit and integration tests for Kite data module
│       └── com/moneytree/connectivity/kite/      # Contract tests for Kite connectivity
└── specs/
    └── 001-kite-modulith-api/                    # This feature’s documentation
```

**Structure Decision**: Reuse the existing `backend` Java modulith project and introduce internal modules/packages for Kite connectivity and Kite-backed market data, keeping a single deployable unit and aligning with the constitution’s modulith guidance. Tests will be grouped alongside these modules under `src/test/java` with separate unit, integration, and contract-style coverage for Kite-related behavior.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
