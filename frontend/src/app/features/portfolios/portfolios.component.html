<!-- Page Header -->
<app-page-header
  title="Portfolios"
  subtitle="Configure and manage your investment portfolios"
  actionButtonLabel="Create Portfolio"
  actionButtonIcon="pi pi-plus"
  (actionButtonClick)="createPortfolio()">
</app-page-header>

<div class="page-container">

  <!-- Summary Cards Section -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-content">
        <div class="card-value">{{ totalPortfolios }}</div>
        <div class="card-label">Total Portfolios</div>
      </div>
      <div class="card-icon">
        <i class="pi pi-chart-line"></i>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-content">
        <div class="card-value">{{ activePortfolios }}</div>
        <div class="card-label">Active Portfolios</div>
      </div>
      <div class="card-icon">
        <i class="pi pi-check-circle"></i>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-content">
        <div class="card-value">{{ conservativePortfolios }}</div>
        <div class="card-label">Conservative</div>
      </div>
      <div class="card-icon">
        <i class="pi pi-shield"></i>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-content">
        <div class="card-value">{{ moderatePortfolios }}</div>
        <div class="card-label">Moderate</div>
      </div>
      <div class="card-icon">
        <i class="pi pi-balance-scale"></i>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-content">
        <div class="card-value">{{ aggressivePortfolios }}</div>
        <div class="card-label">Aggressive</div>
      </div>
      <div class="card-icon">
        <i class="pi pi-rocket"></i>
      </div>
    </div>
  </div>

  <!-- Two-Panel Layout -->
  <div class="two-panel-layout">
    <!-- Left Sidebar -->
    <div class="left-sidebar">
      <!-- Search Input -->
      <div class="search-section">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="searchText" 
            (ngModelChange)="onSearchChange()"
            placeholder="Search portfolios..." 
            class="search-input" />
        </span>
      </div>

      <!-- Portfolio List -->
      <div class="portfolio-list" *ngIf="!loading">
        <div 
          *ngFor="let portfolio of filteredPortfolios; trackBy: trackPortfolioById"
          class="portfolio-card"
          [class.selected]="selectedPortfolio?.id === portfolio.id"
          (click)="selectPortfolio(portfolio)">
          
          <div class="portfolio-card-header">
            <h3 class="portfolio-name">{{ portfolio.name }}</h3>
            <p-tag 
              [value]="portfolio.isActive ? 'Active' : 'Inactive'" 
              [severity]="portfolio.isActive ? 'success' : 'secondary'">
            </p-tag>
          </div>

          <p class="portfolio-description">{{ portfolio.description }}</p>

          <div class="portfolio-metrics">
            <div class="metric">
              <span class="metric-label">Return</span>
              <span 
                class="metric-value" 
                [style.color]="getPerformanceColor(portfolio.totalReturn || 0)">
                {{ formatReturn(portfolio.totalReturn || 0) }}
              </span>
            </div>
            <div class="metric">
              <span class="metric-label">Stocks</span>
              <span class="metric-value">{{ portfolio.stockCount || 0 }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Outperformance</span>
              <span 
                class="metric-value" 
                [style.color]="getPerformanceColor(portfolio.outperformance || 0)">
                {{ formatReturn(portfolio.outperformance || 0) }}
              </span>
            </div>
          </div>

          <div class="portfolio-footer">
            <span class="last-executed">
              <i class="pi pi-clock"></i>
              Last: {{ portfolio.lastRebalance || 'N/A' }}
            </span>
            <span class="risk-profile">
              <i [class]="getPortfolioIcon(portfolio.riskProfile)"></i>
              {{ getRiskProfileLabel(portfolio.riskProfile) }}
            </span>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredPortfolios.length === 0" class="empty-state">
          <i class="pi pi-inbox"></i>
          <p>No portfolios found</p>
          <p-button 
            label="Clear Filters" 
            icon="pi pi-filter-slash" 
            (onClick)="clearFilters()"
            [text]="true">
          </p-button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <i class="pi pi-spin pi-spinner"></i>
        <p>Loading portfolios...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error" class="error-state">
        <i class="pi pi-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <p-button 
          label="Retry" 
          icon="pi pi-refresh" 
          (onClick)="loadPortfolios()"
          [text]="true">
        </p-button>
      </div>
    </div>

    <!-- Right Detail Panel -->
    <div class="right-panel">
      <!-- Show message when no portfolio is selected -->
      <div *ngIf="!selectedPortfolio" class="no-selection-state">
        <i class="pi pi-chart-line"></i>
        <h3>Select a Portfolio</h3>
        <p>Choose a portfolio from the list to view details and manage settings</p>
      </div>

      <!-- Show tabs when a portfolio is selected -->
      <div *ngIf="selectedPortfolio" class="portfolio-detail">
        <p-tabs [(value)]="activeTab" (valueChange)="onTabChange($event)">
          <p-tablist>
            <p-tab value="overview">
              <i class="pi pi-chart-line"></i>
              Overview
            </p-tab>
            <p-tab value="configure">
              <i class="pi pi-cog"></i>
              Configure
            </p-tab>
            <p-tab value="holdings">
              <i class="pi pi-briefcase"></i>
              Holdings
            </p-tab>
            <p-tab value="trades">
              <i class="pi pi-history"></i>
              Trades
            </p-tab>
          </p-tablist>
          <p-tabpanels>
            <!-- Overview Tab -->
            <p-tabpanel value="overview">
              <div class="tab-content">
                <h3>Overview - {{ selectedPortfolio.name }}</h3>
                <p>Overview content will be implemented in future tasks</p>
              </div>
            </p-tabpanel>

            <!-- Configure Tab -->
            <p-tabpanel value="configure">
              <div class="tab-content configure-tab">
                <h3 class="tab-title">Portfolio Configuration</h3>

                <!-- Basic Settings Section -->
                <div class="config-section">
                  <h4 class="section-title">Basic Settings</h4>
                  <div class="form-grid">
                    <div class="form-field">
                      <label for="portfolio-name">Portfolio Name <span class="required">*</span></label>
                      <input 
                        id="portfolio-name"
                        type="text" 
                        pInputText 
                        [(ngModel)]="configForm.name"
                        (ngModelChange)="onConfigFormChange()"
                        placeholder="Enter portfolio name"
                        class="form-input" />
                    </div>

                    <div class="form-field full-width">
                      <label for="portfolio-description">Description <span class="required">*</span></label>
                      <textarea 
                        id="portfolio-description"
                        pTextarea 
                        [(ngModel)]="configForm.description"
                        (ngModelChange)="onConfigFormChange()"
                        placeholder="Enter portfolio description"
                        rows="3"
                        class="form-input">
                      </textarea>
                    </div>
                  </div>
                </div>

                <!-- Risk Profile Section -->
                <div class="config-section">
                  <h4 class="section-title">Risk Profile</h4>
                  <div class="form-grid">
                    <div class="form-field">
                      <label for="risk-profile">Risk Profile <span class="required">*</span></label>
                      <p-select 
                        id="risk-profile"
                        [(ngModel)]="configForm.riskProfile"
                        (ngModelChange)="onConfigFormChange()"
                        [options]="riskProfileOptions"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select risk profile"
                        class="form-input">
                      </p-select>
                    </div>

                    <div class="form-field">
                      <label for="risk-tolerance">Risk Tolerance <span class="required">*</span></label>
                      <p-select 
                        id="risk-tolerance"
                        [(ngModel)]="configForm.riskTolerance"
                        (ngModelChange)="onConfigFormChange()"
                        [options]="riskToleranceOptions"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select risk tolerance"
                        class="form-input">
                      </p-select>
                    </div>
                  </div>
                </div>

                <!-- Rebalancing Strategy Section -->
                <div class="config-section">
                  <h4 class="section-title">Rebalancing Strategy</h4>
                  <div class="form-grid">
                    <div class="form-field">
                      <label for="rebalancing-strategy">Strategy <span class="required">*</span></label>
                      <p-select 
                        id="rebalancing-strategy"
                        [(ngModel)]="configForm.rebalancingStrategy"
                        (ngModelChange)="onConfigFormChange()"
                        [options]="rebalancingStrategyOptions"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select rebalancing strategy"
                        class="form-input">
                      </p-select>
                    </div>

                    <div class="form-field">
                      <label for="rebalancing-threshold">Threshold (%) <span class="required">*</span></label>
                      <p-inputnumber 
                        id="rebalancing-threshold"
                        [(ngModel)]="configForm.rebalancingThreshold"
                        (ngModelChange)="onConfigFormChange()"
                        [min]="0"
                        [max]="100"
                        [step]="1"
                        suffix="%"
                        placeholder="Enter threshold"
                        class="form-input">
                      </p-inputnumber>
                    </div>
                  </div>
                </div>

                <!-- Execution Preferences Section -->
                <div class="config-section">
                  <h4 class="section-title">Execution Preferences</h4>
                  <div class="form-grid">
                    <div class="form-field">
                      <label for="automated-execution">Automated Execution</label>
                      <div class="toggle-field">
                        <p-togglebutton 
                          id="automated-execution"
                          [(ngModel)]="configForm.automatedExecution"
                          (ngModelChange)="onConfigFormChange()"
                          onLabel="Enabled"
                          offLabel="Disabled"
                          onIcon="pi pi-check"
                          offIcon="pi pi-times">
                        </p-togglebutton>
                        <span class="field-hint">Automatically execute rebalancing trades</span>
                      </div>
                    </div>

                    <div class="form-field">
                      <label for="notification-settings">Notification Settings</label>
                      <div class="toggle-field">
                        <p-togglebutton 
                          id="notification-settings"
                          [(ngModel)]="configForm.notificationSettings"
                          (ngModelChange)="onConfigFormChange()"
                          onLabel="Enabled"
                          offLabel="Disabled"
                          onIcon="pi pi-check"
                          offIcon="pi pi-times">
                        </p-togglebutton>
                        <span class="field-hint">Receive notifications for portfolio events</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Advanced Options Section -->
                <div class="config-section">
                  <h4 class="section-title">Advanced Options</h4>
                  <div class="form-grid">
                    <div class="form-field">
                      <label for="tax-harvesting">Tax Loss Harvesting</label>
                      <div class="toggle-field">
                        <p-togglebutton 
                          id="tax-harvesting"
                          [(ngModel)]="configForm.taxHarvesting"
                          (ngModelChange)="onConfigFormChange()"
                          onLabel="Enabled"
                          offLabel="Disabled"
                          onIcon="pi pi-check"
                          offIcon="pi pi-times">
                        </p-togglebutton>
                        <span class="field-hint">Optimize trades for tax efficiency</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="config-actions">
                  <p-button 
                    label="Reset"
                    icon="pi pi-refresh"
                    severity="secondary"
                    [outlined]="true"
                    (onClick)="resetConfiguration()"
                    [disabled]="!configFormDirty || savingConfig">
                  </p-button>
                  <p-button 
                    label="Save Configuration"
                    icon="pi pi-save"
                    severity="primary"
                    (onClick)="saveConfiguration()"
                    [disabled]="!isSaveButtonEnabled() || savingConfig"
                    [loading]="savingConfig">
                  </p-button>
                </div>
              </div>
            </p-tabpanel>

            <!-- Holdings Tab -->
            <p-tabpanel value="holdings">
              <div class="tab-content">
                <h3>Holdings - {{ selectedPortfolio.name }}</h3>
                <p>Holdings content will be implemented in future tasks</p>
              </div>
            </p-tabpanel>

            <!-- Trades Tab -->
            <p-tabpanel value="trades">
              <div class="tab-content">
                <h3>Trades - {{ selectedPortfolio.name }}</h3>
                <p>Trades content will be implemented in future tasks</p>
              </div>
            </p-tabpanel>
          </p-tabpanels>
        </p-tabs>
      </div>
    </div>
  </div>
</div>