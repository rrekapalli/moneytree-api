<div class="dashboard-header">
  <div class="dashboard-header-left">
    <h2 class="dashboard-title" *ngIf="!showInstrumentFilters">{{ title }}</h2>
    
    <!-- Instrument Filters Section -->
    <div *ngIf="showInstrumentFilters" class="instrument-filters">
      <div class="filter-group">
        <label class="filter-label">Exchange</label>
        <p-select 
          [options]="filterOptions.exchanges" 
          [(ngModel)]="selectedFilters.exchange"
          (onChange)="onExchangeChange($event.value)"
          [loading]="isLoadingFilters"
          placeholder="Select Exchange"
          [style]="{'width': '150px'}">
        </p-select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Index</label>
        <p-select 
          [options]="filterOptions.indices" 
          [(ngModel)]="selectedFilters.index"
          (onChange)="onIndexChange($event.value)"
          [loading]="isLoadingFilters"
          placeholder="Select Index"
          [style]="{'width': '200px'}">
        </p-select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Segment</label>
        <p-select 
          [options]="filterOptions.segments" 
          [(ngModel)]="selectedFilters.segment"
          (onChange)="onSegmentChange($event.value)"
          [loading]="isLoadingFilters"
          placeholder="Select Segment"
          [style]="{'width': '150px'}">
        </p-select>
      </div>
    </div>
  </div>
  
  <div class="dashboard-header-right">
    <!-- Stock search box (appears before custom header actions and the menu) -->
    <div *ngIf="enableStockSearch" class="header-search">
      <div class="search-input-container">
        <i class="pi pi-search search-icon"></i>
        <input 
          type="text" 
          class="header-search-input" 
          placeholder="Search stock symbol or company name" 
          [(ngModel)]="searchQuery"
          (input)="onSearchInput($event)"
          (keyup.enter)="onSubmitSearch($event.target.value)" />
      </div>
      
      <!-- Search results dropdown -->
      <div *ngIf="showSearchResults" class="search-results">
        <div 
          *ngFor="let stock of filteredStocks" 
          class="search-result-item"
          (click)="selectStock(stock)">
          <span class="stock-symbol">{{ stock.symbol }}</span>
          <span *ngIf="stock.name" class="stock-name">{{ stock.name }}</span>
        </div>
      </div>
    </div>
    
    <!-- Custom Menu (Working Solution) -->
    <div class="custom-menu-container">
      <button class="custom-menu-button" (click)="toggleCustomMenu()">
        <i class="pi pi-ellipsis-v"></i>
      </button>
      
      <div class="custom-menu" *ngIf="showCustomMenu">
        <div class="custom-menu-item" (click)="testCustomClick('excel')"
             [class.loading]="isExportingExcel">
          <i class="pi pi-file-excel" *ngIf="!isExportingExcel"></i>
          <i class="pi pi-spin pi-spinner" *ngIf="isExportingExcel"></i>
          {{ isExportingExcel ? 'Exporting Excel...' : 'Export to Excel' }}
        </div>
        <div class="custom-menu-separator"></div>
        <div class="custom-menu-item" (click)="testCustomClick('toggle')">
          <i class="pi" [class.pi-eye-slash]="isHighlightingEnabled" [class.pi-eye]="!isHighlightingEnabled"></i>
          {{ isHighlightingEnabled ? 'Disable' : 'Enable' }} Highlighting
        </div>
        <div class="custom-menu-separator" *ngIf="isHighlightingEnabled"></div>
        <div class="custom-menu-item" *ngIf="isHighlightingEnabled" (click)="testCustomClick('subtle')">
          <i class="pi pi-circle"></i>
          Subtle (40%)
        </div>
        <div class="custom-menu-item" *ngIf="isHighlightingEnabled" (click)="testCustomClick('medium')">
          <i class="pi pi-circle"></i>
          Medium (25%)
        </div>
        <div class="custom-menu-item" *ngIf="isHighlightingEnabled" (click)="testCustomClick('strong')">
          <i class="pi pi-circle"></i>
          Strong (10%)
        </div>
        <div class="custom-menu-separator"></div>
        <div class="custom-menu-item" (click)="testCustomClick('refresh')">
          <i class="pi pi-refresh"></i>
          Force Tile Refresh
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Actions Menu (hidden for now) -->
<p-menu #menu 
        [model]="menuItems" 
        [popup]="true" 
        appendTo="body"
        (onShow)="onMenuShow()"
        (onHide)="onMenuHide()"
        [style]="{ display: 'none' }">
</p-menu> 